let wnd = api.window();

wnd.create(600, 400);

let dragCrt = func() {
	if (wnd.isAlive() == 0) {
		print("Window closed!");
		wnd = none;
		return;
	}
	wnd.drag();
	timeout(dragCrt, 0);
};
dragCrt();


let device = api.device();
let renderCrt = func() {
	if (wnd.isAlive() == 0) {
		return;
	}

	try {
		device.render();
	} catch(e) {
		print(e);
		return;
	}

	timeout(renderCrt);
};

let shaderCode = readFile("shaders.hlsl");

let vertexShader = api.vertexShader();
let pixelShader = api.pixelShader();

let fence = api.fence();

try {
	vertexShader.compile(shaderCode);
	pixelShader.compile(shaderCode);
	print("Shaders compiled!");

	device.init(wnd);

	fence.create(device);
	print("Fence created!");

	device.load(vertexShader, pixelShader, fence);
	print("Device Init Completed!");

	renderCrt();
} catch (e) {
	print(e);
}

let heap = api.heap();

try {
	heap.create(device, 12);
	print("Heap Created!");
} catch(e) {
	print(e);
}


